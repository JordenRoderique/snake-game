<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snake Game</title>
</head>
<body>
  <canvas id="snake" width="400" height="400" style="border: 1px solid #000;"></canvas>
  <script type="application/javascript" defer>
    const canvas = document.getElementById("snake");
    const ctx = canvas.getContext("2d");
    const cellSize = [10, 10];
    const snake = [[160, 200], [150, 200], [140, 200], [130, 200]];
    let foodLocation = [canvas.width / 2, canvas.height / 2];
    let direction = 'right';
    let score = 0;
    let gameTick = 200;
    let turningLocked = false;
    let gameOver = false;

    function renderCell(location) {
      ctx.fillStyle = 'rgb(0, 250, 0)';
      ctx.fillRect(...location, ...cellSize);
    }

    function renderSnake(snake) {
      snake.forEach(cell => {
        ctx.fillStyle = 'rgb(0, 250, 0)';
        ctx.fillRect(...cell, ...cellSize);
      });
    }

    function setRandomFood() {
      const allLocations = [];
      for (let x = 0; x < canvas.width; x += 10) {
        for (let y = 0; y < canvas.height; y += 10) {
          allLocations.push([x, y]);
        }
      }

      const snakeLocations = new Set(snake.map(cell => cell.toString()));
      const availableLocations = allLocations.filter(locations => !snakeLocations.has(locations.toString()));

      const randomIndex = Math.floor(Math.random() * availableLocations.length);
      foodLocation = availableLocations[randomIndex];
    }

    function clearCell(cell) {
      ctx.clearRect(...cell, ...cellSize);
    }

    function move(direction) {
      eatCheck();
      clearCell(snake.pop());
      if (direction === 'right') {
        snake.unshift([snake[0][0] + 10, snake[0][1]]);
        renderCell(snake[0]);
      }
      if (direction === 'left') {
        snake.unshift([snake[0][0] - 10, snake[0][1]]);
        renderCell(snake[0]);
      }
      if (direction === 'up') {
        snake.unshift([snake[0][0], snake[0][1] - 10]);
        renderCell(snake[0]);
      }
      if (direction === 'down') {
        snake.unshift([snake[0][0], snake[0][1] + 10]);
        renderCell(snake[0]);
      }
    }

    function eatCheck() {
      if (snake[0].toString() === [foodLocation[0] + 10, foodLocation[1]].toString() ||
      snake[0].toString() === [foodLocation[0] - 10, foodLocation[1]].toString() ||
      snake[0].toString() === [foodLocation[0], foodLocation[1] + 10].toString() ||
      snake[0].toString() === [foodLocation[0], foodLocation[1] - 10].toString()) {
        setRandomFood();
        score += 1;
        gameTick *= 0.98;
        ctx.fillStyle = 'rgb(0, 250, 0)';
        ctx.fillRect(...foodLocation, ...cellSize);
        snake.unshift([snake[0][0] + 10, snake[0][1]]);
      }
    }

    function handleKeypress({ key }) {
      const canTurn = !turningLocked;
      console.log(direction);
      turningLocked = true;
      if (canTurn && key === 'ArrowLeft' || key === 'ArrowRight') {
        switch (direction) {
          case 'right':
            if (key === 'ArrowLeft') {
              direction = 'up';
            } else if (key === 'ArrowRight') {
              direction = 'down';
            }
            break;
          case 'left':
            if (key === 'ArrowLeft') {
              direction = 'down';
            } else if (key === 'ArrowRight') {
              direction = 'up';
            }
            break;
          case 'up':
            if (key === 'ArrowLeft') {
              direction = 'left';
            } else if (key === 'ArrowRight') {
              direction = 'right';
            }
            break;
          case 'down':
            if (key === 'ArrowLeft') {
              direction = 'right';
            } else if (key === 'ArrowRight') {
              direction = 'left';
            }
            break;
        }
      }
    }

    if (canvas.getContext) {
      renderSnake(snake);
      renderCell(foodLocation);
      document.addEventListener('keydown', handleKeypress);
      setInterval(() => {
        move(direction);
        turningLocked = false;
      }, gameTick);
    }

  </script>
</body>
</html>
